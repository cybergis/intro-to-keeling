
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.9">
    
    
      
        <title>Example Jobs - Intro to Keeling</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2b4465f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#example-jobs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Intro to Keeling" class="md-header__button md-logo" aria-label="Intro to Keeling" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Intro to Keeling
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Example Jobs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cybergis/intro-to-keeling/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Intro to Keeling" class="md-nav__button md-logo" aria-label="Intro to Keeling" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Intro to Keeling
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cybergis/intro-to-keeling/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ssh-terminal/" class="md-nav__link">
        SSH and Terminal Basics
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Example Jobs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Example Jobs
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#countpy-example" class="md-nav__link">
    Count.py Example
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conda/" class="md-nav__link">
        Installing and Using Anaconda
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        Managing Data on Keeling
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../faq-resources/" class="md-nav__link">
        Concepts, Resources, and FAQ
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#countpy-example" class="md-nav__link">
    Count.py Example
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/cybergis/intro-to-keeling/edit/master/docs/example-jobs.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="example-jobs">Example Jobs</h1>
<p>Now that you're acquainted with Keeling and have this repository downloaded, we can get some hands-on experience in running jobs in SLURM.</p>
<h2 id="countpy-example">Count.py Example</h2>
<ol>
<li>
<p>Let's examine the count.py example. You can see what it looks like with the <code>cat</code> command which displays the contents of a file.</p>
<pre><code>&gt; cat count.py

import os
import time

count_to = 1
try:
count_to = os.getenv("HOWHIGHTOCOUNT")
except Exception as e:
print(e)

if count_to is None:
count_to = 30

for i in range(int(count_to)):
print(i)
time.sleep(1)
</code></pre>
<p>It's a pretty simple script. It counts to <code>count_to</code> taking a one-second break after each number. It also tries to grab a number from the environment variables. The variable it tries to grab is <code>HOWHIGHTOCOUNT</code>. If that fails, it prints the exception and uses a default of 30.</p>
</li>
<li>
<p>How do we run this job?</p>
<p>You should try to not run things on the head node because:</p>
<ul>
<li>everyone is sharing that one node</li>
<li>running through slurm means you can use multiple nodes at once.</li>
</ul>
<p>To run the count.py job with <code>run_count.py</code>:</p>
<pre><code>#!/bin/tcsh
#SBATCH --job-name=ex-count
#SBATCH -n 1
#SBATCH --time=1:00:00
#SBATCH --mem-per-cpu=50MB
#SBATCH --mail-type=FAIL
#SBATCH --mail-type=END
#SBATCH --mail-user=&lt;YOUR EMAIL&gt;

python3 count.py
</code></pre>
<p>Let's break it down line-by-line:</p>
<ul>
<li><code>#!/bin/tcsh</code> - the <code>#!</code> is called a <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> and tells the computer to run the script with <code>/bin/tcsh</code>.</li>
<li><code>#SBATCH --job-name=ex-count</code> - this tells SLURM to name the job "ex-count"</li>
<li><code>#SBATCH -n 1</code> - this says we only need one task. You may need more for parallel code.</li>
<li><code>#SBATCH --time=1:00:00</code> - this tells SLURM to stop the job after an hour. The format is hours:minutes:seconds.</li>
<li><code>#SBATCH --mem-per-cpu=50MB</code> - the amount of memory per CPU</li>
<li><code>#SBATCH --mail-type=FAIL</code> - email me if it fails</li>
<li><code>#SBATCH --mail-type=END</code> - email me when it ends</li>
<li><code>#SBATCH --mail-user=&lt;YOUR EMAIL&gt;</code> - your email</li>
<li><code>python3 count.py</code> - run count.py with python.</li>
</ul>
</li>
<li>
<p>You can make a CoPy of the run_count.sbatch with the <code>cp</code>. The <code>cp</code> command (and many commands) work with source and destination. So to copy the <code>run_count.sbatch</code> file to <code>my_count.sbatch</code>, you could use:</p>
<pre><code>cp run_count.sbatch my_count.sbatch
</code></pre>
</li>
<li>
<p>Now that you've copied it, you can edit the file with <code>nano</code>. Run</p>
<pre><code>nano my_count.sbatch
</code></pre>
<p>Use arrows to navigate to the email section, then delete <code>&lt;YOUR EMAIL&gt;</code> and replace it with your email. Once this is done you can exit nano with <code>CTRL+X</code> (it says this at the bottom of the window). </p>
<p>It will ask "Save modified buffer (ANSWERING "No" WILL DESTROY CHANGES) ?" To save your changes, answer "Y".</p>
<p>Next, it will ask "File Name to Write:" and you can just press enter.</p>
</li>
<li>
<p>To submit a job, you can use the <code>sbatch</code> command. Specifically:</p>
<pre><code>&gt; sbatch my_count.sbatch

Submitted batch job XXXXXX
</code></pre>
<p>It should say "Submitted batch job" with a number just as in above. To see what jobs are running you can use <code>squeue</code> to view the SLURM queue. To see your jobs, you can use <code>squeue -u &lt;YOUR NETID&gt;</code>.</p>
</li>
<li>
<p>The count job only takes about 30 seconds and once it is over, you should get an email. If you use <code>ls</code> you should also see a file of the form <code>slurm-XXXXX.out</code> where the "XXXXX" number matches the one you saw when you submitted the job. To view the contents of the file, use <code>cat slurm-XXXX.out</code></p>
</li>
<li>
<p>Next, we will see how to pass the value of <code>HOWHIGHTOCOUNT</code> from the sbatch script. For something this simple it may not be entirely useful, but this method can be used to pass parameters and inputs to more complex analysis and models.</p>
<p>To set an environment variable in this script insert:</p>
<pre><code>setenv HOWHIGHTOCOUNT 10
</code></pre>
<p>in the line above <code>python3 count.py</code>. The line sets an environmental variable called <code>HOWHIGHTOCOUNT</code> to "10". You can use any number here, but keep in mind that it will run for that many seconds.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul>
<li>It must precede the python line or else the python script will run without the environmental variable set.</li>
<li>All environmental variables are strings. You can treat it as different type in your script (such as we do), but it will be read from the environment as a string.</li>
</ul>
</div>
<p>Now you can re-run the batch job and check the output again. You should see that it only counted up to your new number.</p>
</li>
<li>
<p>You probably don't want to make a separate sbatch file for each job though, especially if we are just changing a single parameter. First, delete the <code>setenv</code> line from the sbatch file. Now, let's submit the count job multiple times for many different values of <code>HOWHIGHTOCOUNT</code>. You can do that with the <code>many_counts.sh</code> bash script:</p>
<pre><code>#!/bin/bash
for i in {30..40}; do
    export HOWHIGHTOCOUNT=$i
    sbatch my_count.sbatch
    sleep 1
done
</code></pre>
<p>Breaking this down:</p>
<ul>
<li><code>#!/bin/bash</code> - this is the shebang again, this time telling us to use bash. Bash is the default language in the terminal, so we've been using it the whole time!</li>
<li><code>for i in {30..40}; do .... done</code> - is a bash for loop which loops from 30 to 40. The <a href="https://devhints.io/bash">bash cheat sheet</a> has more on this syntax.</li>
<li>Within the loop we are:</li>
<li><code>export HOWHIGHTOCOUNT=$i</code> - this is the bash equivalent of <code>setenv</code></li>
<li><code>sbatch my_count.sbatch</code> - this submits our job</li>
<li><code>sleep 1</code> - pause for a second. It is best practice to pause a bit between submitting jobs</li>
</ul>
</li>
</ol>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ssh-terminal/" class="md-footer__link md-footer__link--prev" aria-label="Previous: SSH and Terminal Basics" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              SSH and Terminal Basics
            </div>
          </div>
        </a>
      
      
        
        <a href="../conda/" class="md-footer__link md-footer__link--next" aria-label="Next: Installing and Using Anaconda" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Installing and Using Anaconda
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>